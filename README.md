# OceanBase 多模态产品推荐系统

[![Python](https://img.shields.io/badge/Python-3.10+-blue.svg)](https://www.python.org/downloads/)
[![OceanBase](https://img.shields.io/badge/OceanBase-Vector%20Database-green.svg)](https://www.oceanbase.com/)
[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

🚀 **演示 OceanBase 强大的向量数据库与多模态混合检索能力的Demo**

这是一个基于 OceanBase 向量数据库的智能产品推荐系统，展示了如何利用 OceanBase 的多模态向量检索能力，实现自然语言 + 图像的混合检索，为用户提供精准的产品推荐服务。

## ✨ 核心亮点

### 🎯 OceanBase 向量数据库能力展示
- **多模态向量存储**: 同时存储文本向量和图像向量，支持跨模态检索
- **高性能向量检索**: 基于 OceanBase 的向量索引进行毫秒级相似度搜索
- **混合检索策略**: 结合传统关系型查询和向量相似度检索
- **向量维度优化**: 支持不同维度的向量存储和检索优化

### 🤖 AI 驱动的智能推荐
- **自然语言理解**: 基于大语言模型理解用户复杂的查询意图
- **多模态搜索**: 支持"文字描述 + 图片示例"的组合检索方式
- **智能推荐**: 基于用户偏好和历史行为进行个性化推荐
- **对话式交互**: 支持多轮对话，逐步细化用户需求

### 🔧 技术特性
- **向量化处理**: 使用先进的嵌入模型将文本和图像转换为高维向量
- **相似度计算**: 基于余弦相似度等算法进行精确的相似度匹配
- **实时检索**: 毫秒级响应的向量检索性能
- **可扩展架构**: 支持大规模产品数据的向量化存储和检索

## 🏗️ 系统架构

本系统展示了 OceanBase 向量数据库在多模态AI应用中的强大能力：

```
🔄 多模态数据流程
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│   用户输入       │ -> │   向量化处理      │ -> │  OceanBase      │
│ 文字+图片       │    │ 文本/图像嵌入     │    │  向量数据库     │
└─────────────────┘    └──────────────────┘    └─────────────────┘
                                                        │
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│   智能推荐       │ <- │   相似度计算      │ <- │  向量检索       │
│   结果展示       │    │   排序算法       │    │  混合查询       │
└─────────────────┘    └──────────────────┘    └─────────────────┘

📁 代码结构
srd/
├── agents/                    # 🤖 AI 代理模块
│   ├── conversation_agent.py  # 对话流程控制
│   ├── extract_agent.py       # 需求信息抽取
│   ├── consult_agent.py       # 智能咨询引导
│   ├── recommendation_agent.py # 推荐算法引擎
│   └── normal_chat_agent.py   # 通用对话处理
├── tools/                     # 🔧 核心工具
│   ├── retrieval_tool.py      # 向量检索工具
│   └── tool.py               # 基础工具类
├── llm/                      # 🧠 大语言模型
│   ├── llm.py                # LLM 接口抽象
│   └── tongyi.py             # 通义千问集成
├── data/                     # 📊 数据处理
│   └── sofa_data_preprocessor.py # 数据向量化预处理
└── prompt/                   # 💬 提示词工程
    └── prompt_list.py        # 系统提示词模板
```

### 🎯 OceanBase 向量数据库核心能力

1. **🗄️ 多模态向量存储**
   - 文本向量：使用文本嵌入模型生成的高维向量
   - 图像向量：通过视觉嵌入模型提取的图像特征向量
   - 元数据存储：产品属性、价格、规格等结构化数据

2. **⚡ 高性能向量检索**
   - 基于向量索引的快速相似度搜索
   - 支持 L2 距离、余弦相似度等多种相似度计算
   - 毫秒级查询响应时间

3. **🔄 混合检索策略**
   - 向量检索 + 传统SQL查询的组合
   - 支持复杂的筛选条件和排序规则
   - 智能的结果融合和排序算法

## 🚀 快速开始

### 1. 📋 环境要求

- **Python 3.10+**
- **OceanBase 数据库** (支持向量检索功能)
- **uv** (现代Python包管理器)
- **DashScope API 密钥** (通义千问访问)

### 2. ⚡ 一键安装

```bash
# 克隆项目
git clone <your-repo-url>
cd oceanbase-demo

# 使用 uv 创建虚拟环境并安装依赖
uv venv
source .venv/bin/activate
uv pip install -e .
```

### 3. 🔧 配置环境

创建 `.env` 文件，配置 OceanBase 和 API 密钥：

```bash
# OceanBase 向量数据库配置
OB_URL="your-oceanbase-url"
OB_USER="your-username"  
OB_DB_NAME="your-database-name"
OB_PWD="your-password"
OB_DB_SSL_CA_PATH="optional-ssl-ca-path"

# 通义千问 API 配置
DASHSCOPE_API_KEY="your-dashscope-api-key"
```

### 4. 📊 初始化向量数据

```bash
# 数据向量化预处理
python srd/data/sofa_data_preprocessor.py
```

### 5. 🎉 启动系统

```bash
# 启动命令行界面
python conversation_ui.py

# 或使用 Streamlit Web 界面
streamlit run conversation_ui.py
```

## 💡 使用示例

### 🎯 场景一：多模态产品搜索
展示 OceanBase 向量数据库的跨模态检索能力

```
👤 您: 我想找一个类似这张图片风格的沙发，要布艺材质的，价格在5000-8000之间，
     最好是北欧风格，而且我家在朝阳区，需要有附近的售后维修点。

🤖 助手: 正在基于 OceanBase 向量数据库进行多模态检索...
     ✅ 图像向量相似度匹配完成
     ✅ 文本语义理解和筛选完成
     ✅ 地理位置和服务点匹配完成
     
     根据您的需求，我为您推荐以下几款高匹配度的沙发产品...
```

### 🔍 场景二：智能比较与推荐
基于向量相似度的智能产品对比

```  
👤 您: 帮我比较一下几个北欧风格的沙发产品

🤖 助手: 正在使用 OceanBase 向量检索进行产品对比分析...
     📊 已检索到 15 款北欧风格相关产品
     🎯 基于风格向量相似度排序
     📈 综合评分和特征对比如下...
```

### 🏠 场景三：个性化场景匹配
结合空间信息的智能推荐

```
👤 您: 我要装修新房，客厅是20平米，现代简约风格，帮我推荐合适的沙发产品，
     预算3万以内，要考虑颜色搭配和空间布局。

🤖 助手: 基于您的空间信息进行向量化匹配...
     🏠 空间尺寸向量分析：20平米 -> 推荐中大型沙发
     🎨 风格向量匹配：现代简约 -> 简洁线条设计
     💰 价格区间筛选：30000元以内
     
     为您推荐以下最适合的产品组合...
```

### 📸 图片搜索示例
展示图像向量检索的强大能力

```
👤 您: [上传图片] 我想要类似这个风格的沙发

🤖 助手: 正在进行图像向量相似度计算...
     🖼️ 图像特征提取完成
     🔍 在 OceanBase 向量数据库中搜索相似产品
     📊 相似度分析结果：
     
     相似度 95.2% - 北欧简约三人沙发
     相似度 89.7% - 现代布艺组合沙发
     相似度 87.3% - 简约实木框架沙发
```

## � 功能清单

### ✅ 已实现功能

- [x] **多模态向量检索**: 文本 + 图像的混合搜索
- [x] **智能对话系统**: 基于 LangGraph 的对话流程管理
- [x] **产品推荐引擎**: 基于用户偏好的个性化推荐
- [x] **相似度计算**: 高精度的向量相似度匹配
- [x] **Web 用户界面**: Streamlit 构建的交互式界面
- [x] **数据预处理**: 自动化的向量化数据处理流程

### 🚧 支持的搜索条件

- **材质类型**: 布艺、真皮、人造革、实木等
- **风格分类**: 北欧、现代简约、美式、中式、欧式、日式、工业风、田园风
- **尺寸规格**: 单人、双人、三人、转角、组合沙发
- **价格区间**: 灵活的价格范围筛选
- **地理位置**: 基于位置的服务点匹配
- **颜色搭配**: 主色调和配色方案匹配

### 📱 界面功能

- **对话交互**: 自然语言对话式查询
- **图片上传**: 支持本地图片上传和搜索
- **结果展示**: 丰富的产品信息展示
- **比较功能**: 多产品对比分析
- **历史记录**: 查询历史和收藏功能

## 🧪 运行测试

```bash
# 功能测试
python -m pytest tests/

# 向量检索性能测试
python tests/test_vector_performance.py

# 端到端测试
python tests/test_e2e.py
```

## 🛠️ 技术特点

### 🗄️ OceanBase 向量数据库核心优势

1. **多模态向量存储**
   - 统一存储文本向量、图像向量和结构化数据
   - 支持高维向量（512-4096维）的高效存储和索引
   - 向量数据与业务数据的一体化管理

2. **高性能向量检索**
   - 基于 HNSW 算法的近似最近邻搜索
   - 毫秒级响应时间，支持大规模向量检索
   - 支持批量向量查询和并行处理

3. **混合检索能力**
   - 向量相似度 + SQL 条件的复合查询
   - 支持复杂的业务逻辑和筛选规则
   - 智能的结果融合和重排序算法

4. **企业级特性**
   - 高可用和分布式架构
   - 完整的 ACID 事务支持
   - 丰富的监控和运维工具

### 🤖 AI 技术栈

- **文本嵌入**: 使用先进的文本嵌入模型进行语义向量化
- **图像嵌入**: 基于 CLIP 等多模态模型的图像特征提取
- **大语言模型**: 集成通义千问进行自然语言理解和生成
- **向量检索**: 基于余弦相似度的高效向量匹配算法

### 🔧 开发特性

- **模块化设计**: 清晰的代码结构，易于扩展和维护
- **异步处理**: 支持高并发的异步查询和处理
- **配置管理**: 灵活的环境配置和参数调优
- **错误处理**: 完善的异常处理和日志记录

## 📖 开发说明

### 🎯 项目背景

本项目是 **OceanBase 向量数据库能力的完整展示Demo**，旨在演示：

1. **多模态数据处理**: 如何将文本和图像数据向量化存储
2. **向量检索优化**: 展示 OceanBase 在向量检索方面的性能优势
3. **AI 应用集成**: 如何将向量数据库与大语言模型结合构建智能应用
4. **企业级应用**: 展示向量数据库在实际业务场景中的应用模式

### 🔄 技术演进

本项目基于 OceanBase 的多模态搜索能力，相比传统关系型数据库应用：

- **数据模型升级**: 从结构化数据扩展到向量化数据存储
- **检索能力增强**: 从精确匹配扩展到语义相似度搜索
- **交互方式改进**: 从关键词搜索升级到自然语言对话
- **智能化提升**: 集成 AI 能力实现个性化推荐

### 🛠️ 核心技术栈

```
数据层    │ OceanBase 向量数据库
         │ ├── 向量存储与索引
         │ ├── 混合查询引擎
         │ └── 高性能检索
         │
算法层    │ 向量化与相似度计算
         │ ├── 文本嵌入 (Text Embedding)
         │ ├── 图像嵌入 (Image Embedding)  
         │ └── 相似度算法 (Cosine/L2)
         │
应用层    │ AI 智能应用
         │ ├── LangGraph 对话管理
         │ ├── 通义千问 LLM 集成
         │ └── 多 Agent 协作架构
         │
交互层    │ 用户界面
         │ ├── Streamlit Web UI
         │ ├── 命令行界面
         │ └── API 接口
```

### 📈 性能特点

- **检索速度**: 毫秒级向量相似度计算
- **数据规模**: 支持百万级向量数据存储
- **并发能力**: 高并发查询和实时响应
- **准确性**: 高精度的多模态匹配算法

## 🚨 故障排除

### 常见问题

1. **🔌 数据库连接失败**
   ```bash
   # 检查连接配置
   python -c "from srd.tools.retrieval_tool import test_connection; test_connection()"
   ```

2. **🔑 API 密钥问题**
   ```bash
   # 验证 DashScope API
   python -c "import dashscope; print(dashscope.Generation.call(model='qwen-turbo', prompt='test'))"
   ```

3. **📊 向量数据未初始化**
   ```bash
   # 重新初始化向量数据
   python srd/data/sofa_data_preprocessor.py --reset
   ```

4. **🚀 性能优化**
   - 调整向量维度和索引参数
   - 优化批量查询大小
   - 使用连接池提升并发性能

### 🐛 调试模式

```bash
# 启用详细日志
export LOG_LEVEL=DEBUG
streamlit run conversation_ui.py

# 向量检索调试
python -c "from srd.tools.retrieval_tool import debug_search; debug_search('北欧沙发')"
```

## 🤝 贡献指南

我们欢迎社区贡献！请遵循以下步骤：

1. **Fork 项目**并创建特性分支
2. **代码开发**遵循项目代码规范
3. **测试验证**确保所有测试通过
4. **提交 PR**并详细描述改动内容

### 📝 代码规范

- 使用 `black` 进行代码格式化
- 使用 `flake8` 进行代码检查  
- 编写完整的类型注解
- 添加必要的单元测试

## 📄 许可证

本项目基于 MIT 许可证开源，详见 [LICENSE](LICENSE) 文件。

## 🙏 致谢

- **OceanBase 团队** - 提供强大的向量数据库支持
- **阿里云通义千问** - 提供优秀的大语言模型服务
- **开源社区** - 提供丰富的 AI 和数据库工具

---

💡 **立即体验 OceanBase 向量数据库的强大能力！**

如有问题或建议，欢迎提交 Issue 或联系项目维护者。